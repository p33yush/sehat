<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kerala Migrant Health Records ‚Äî Login</title>
    <link href="login.css" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Header -->
    <header class="site-header" role="banner" aria-label="Site header">
      <div class="brand" aria-hidden="false">
        <div class="title-block" role="heading" aria-level="1">
          <h1>Kerala Migrant Health Records</h1>
          <p>Digital Health Management for Migrant Workers</p>
        </div>
      </div>

      <!-- language pill -->
      <div class="lang-select">
        <label for="language" class="sr-only">Select Language</label>
        <select id="language" name="language">
          <option value="en" selected>English</option>
          <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
          <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
        </select>
      </div>
    </header>

    <!-- Card -->
    <main class="card" role="main">
      <!-- tabs -->
      <nav class="tabs" role="tablist" aria-label="Login or register">
        <button
          id="tabLogin"
          class="active"
          role="tab"
          aria-selected="true"
          aria-controls="loginPanel"
        >
          Login
        </button>
        <button
          id="tabRegister"
          role="tab"
          aria-selected="false"
          aria-controls="registerPanel"
        >
          Register
        </button>
      </nav>

      <section class="form-area">
        <!-- LOGIN -->
        <form id="loginPanel" aria-hidden="false" style="display: block">
          <div class="heading">
            <h2>Welcome Back</h2>
            <p>Access your health records securely</p>
          </div>

          <div class="field">
            <label for="roleLogin">Select Your Role</label>
            <select id="roleLogin" aria-label="Select role">
              <option>Choose your role</option>
              <option>Worker</option>
              <option>Health Center</option>
            </select>
          </div>

          <div class="field">
            <label for="userId">Email or Health Center ID</label>
            <input
              id="userId"
              type="text"
              placeholder="Enter your email or health center ID"
            />
          </div>

          <div class="field">
            <label for="pwd">Password</label>
            <input id="pwd" type="password" placeholder="Enter your password" />
          </div>

          <button type="button" class="btn primary" id="loginBtn">
            Access Health Records
          </button>

          <p class="small-note">Secure ‚Ä¢ Confidential ‚Ä¢ SDG Compliant</p>
        </form>

        <!-- REGISTER -->
        <form id="registerPanel" style="display: none" aria-hidden="true">
          <h2 class="regHead">Join Kerala Health</h2>
          <p class="regHead2">Create your digital health record account</p>

          <div class="field">
            <label for="roleRegister">Select Your Role</label>
            <select id="roleRegister">
              <option value="">Choose your role</option>
              <option value="Worker">Worker</option>
              <option value="Health Center">Health Center</option>
            </select>
          </div>

          <!-- Common Fields -->
          <div class="field-group" id="nameFields">
            <div class="field">
              <label for="firstName"> Name</label>
              <input type="text" id="firstName" placeholder="Enter the name" required />
            </div>
          </div>

          <div class="field">
            <label for="email">Email Address</label>
            <input type="email" id="email" placeholder="Enter your email" required />
          </div>

          <div class="field phone-field">
            <label for="phone">Phone Number</label>
            <div class="phone-input">
              <span class="prefix">+91</span>
              <input type="text" id="phone" placeholder="XXXXX XXXXX" required />
            </div>
          </div>

          <div class="field">
            <label for="password">Create Password</label>
            <input type="password" id="password" placeholder="Create a secure password" required />
          </div>

          <!-- Worker Specific Fields -->
          <div id="workerFields" style="display: none;">
            <h3>üë∑ Complete Worker Information</h3>
            
            <!-- Personal Information Section -->
            <div class="field-group">
              <h4>Personal Information</h4>
              <div class="field">
                <label for="dob">Date of Birth *</label>
                <input type="date" id="dob" required />
              </div>
              <div class="field">
                <label for="gender">Gender *</label>
                <select id="gender" required>
                  <option value="">Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="field">
                <label for="bloodGroup">Blood Group *</label>
                <select id="bloodGroup" required>
                  <option value="">Select Blood Group</option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                </select>
              </div>
              <div class="field">
                <label for="maritalStatus">Marital Status *</label>
                <select id="maritalStatus" required>
                  <option value="">Select Marital Status</option>
                  <option value="Single">Single</option>
                  <option value="Married">Married</option>
                  <option value="Divorced">Divorced</option>
                  <option value="Widowed">Widowed</option>
                </select>
              </div>
            </div>

            <!-- Contact Information Section -->
            <div class="field-group">
              <h4>Contact Information</h4>
              <div class="field">
                <label for="address">Current Address *</label>
                <textarea id="address" placeholder="Your current address (e.g., Worker Camp, Kochi Construction Site)" required></textarea>
              </div>
              <div class="field">
                <label for="homeState">Home State *</label>
                <select id="homeState" required>
                  <option value="">Select Home State</option>
                  <option value="Bihar">Bihar</option>
                  <option value="Uttar Pradesh">Uttar Pradesh</option>
                  <option value="West Bengal">West Bengal</option>
                  <option value="Odisha">Odisha</option>
                  <option value="Jharkhand">Jharkhand</option>
                  <option value="Madhya Pradesh">Madhya Pradesh</option>
                  <option value="Rajasthan">Rajasthan</option>
                  <option value="Assam">Assam</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="field">
                <label for="emergencyContact">Emergency Contact *</label>
                <input type="text" id="emergencyContact" placeholder="Emergency contact number and relationship (e.g., +91 87654 32109 - Wife)" required />
              </div>
            </div>

            <!-- Work Information Section -->
            <div class="field-group">
              <h4>Work Information</h4>
              <div class="field">
                <label for="occupation">Job Role/Occupation *</label>
                <input type="text" id="occupation" placeholder="Your job role (e.g., Construction Worker)" required />
              </div>
              <div class="field">
                <label for="workLocation">Work Site/Location *</label>
                <input type="text" id="workLocation" placeholder="Where do you work? (e.g., Kochi Construction Site)" required />
              </div>
              <div class="field">
                <label for="startDate">Work Start Date *</label>
                <input type="date" id="startDate" required />
              </div>
              <div class="field">
                <label for="contractor">Contractor/Company *</label>
                <input type="text" id="contractor" placeholder="Name of contractor or company (e.g., ABC Construction Ltd.)" required />
              </div>
              <div class="field">
                <label for="workHours">Work Hours *</label>
                <input type="text" id="workHours" placeholder="Your work hours (e.g., 8:00 AM - 5:00 PM)" required />
              </div>
              <div class="field">
                <label for="safetyTraining">Safety Training Status *</label>
                <select id="safetyTraining" required>
                  <option value="">Select Training Status</option>
                  <option value="Completed">Completed</option>
                  <option value="In Progress">In Progress</option>
                  <option value="Not Started">Not Started</option>
                </select>
              </div>
            </div>

            <!-- Health Information Section -->
            <div class="field-group">
              <h4>Health Information</h4>
              <div class="field">
                <label for="allergies">Known Allergies</label>
                <input type="text" id="allergies" placeholder="List any known allergies (if any)" />
              </div>
              <div class="field">
                <label for="chronicConditions">Chronic Conditions</label>
                <input type="text" id="chronicConditions" placeholder="List any chronic health conditions (if any)" />
              </div>
              <div class="field">
                <label for="vaccinationStatus">Vaccination Status</label>
                <select id="vaccinationStatus">
                  <option value="">Select Vaccination Status</option>
                  <option value="Up to Date">Up to Date</option>
                  <option value="Partially Vaccinated">Partially Vaccinated</option>
                  <option value="Not Vaccinated">Not Vaccinated</option>
                  <option value="Unknown">Unknown</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Health Center Specific Fields -->
          <div id="healthCenterFields" style="display: none;">
            <h3>üè• Health Center Information</h3>
            <div class="field">
              <label for="centerName">Health Center Name</label>
              <input type="text" id="centerName" placeholder="Name of your health center" />
            </div>
            <div class="field">
              <label for="centerAddress">Health Center Address</label>
              <textarea id="centerAddress" placeholder="Full address of your health center" rows="3"></textarea>
            </div>
            <div class="field">
              <label for="centerPincode">PIN Code</label>
              <input type="text" id="centerPincode" placeholder="PIN code" />
            </div>
            <div class="field">
              <label for="centerType">Health Center Type</label>
              <select id="centerType">
                <option value="">Select Type</option>
                <option value="Primary Health Center">Primary Health Center</option>
                <option value="Community Health Center">Community Health Center</option>
                <option value="District Hospital">District Hospital</option>
                <option value="Medical College">Medical College</option>
                <option value="Private Clinic">Private Clinic</option>
              </select>
            </div>
            <div class="field">
              <label for="licenseNumber">License Number</label>
              <input type="text" id="licenseNumber" placeholder="Medical license number" />
            </div>
            <div class="field">
              <label for="services">Services Offered</label>
              <textarea id="services" placeholder="List the services your center offers" rows="3"></textarea>
            </div>
          </div>

          <button type="submit" class="btn primary">
            Create Health Account
          </button>
          <p class="small-note">Secure ‚Ä¢ Confidential ‚Ä¢ SDG Compliant</p>
        </form>
      </section>
    </main>

    <footer class="footer" role="contentinfo">
      <div>Kerala State Health Department</div>
      <div style="font-size: 12px; opacity: 0.85; margin-top: 6px">
        Promoting equitable healthcare access for all workers
      </div>
    </footer>

    <script>
      // WORKING JAVASCRIPT - EMBEDDED DIRECTLY
      document.addEventListener("DOMContentLoaded", function () {
        console.log("‚úÖ Login page loaded successfully");
        
        // Get all elements
        const tabLogin = document.getElementById("tabLogin");
        const tabRegister = document.getElementById("tabRegister");
        const loginPanel = document.getElementById("loginPanel");
        const registerPanel = document.getElementById("registerPanel");
        const roleRegister = document.getElementById("roleRegister");
        const workerFields = document.getElementById("workerFields");
        const healthCenterFields = document.getElementById("healthCenterFields");
        
        console.log("‚úÖ Elements found:", {
          tabLogin: !!tabLogin,
          tabRegister: !!tabRegister,
          loginPanel: !!loginPanel,
          registerPanel: !!registerPanel,
          roleRegister: !!roleRegister,
          workerFields: !!workerFields,
          healthCenterFields: !!healthCenterFields
        });

        // Tab switching functions
        function showLoginTab() {
          console.log("üîÑ Switching to Login tab");
          tabLogin.classList.add("active");
          tabLogin.setAttribute("aria-selected", "true");
          tabRegister.classList.remove("active");
          tabRegister.setAttribute("aria-selected", "false");
          loginPanel.style.display = "block";
          loginPanel.setAttribute("aria-hidden", "false");
          registerPanel.style.display = "none";
          registerPanel.setAttribute("aria-hidden", "true");
          console.log("‚úÖ Login tab activated");
        }

        function showRegisterTab() {
          console.log("üîÑ Switching to Register tab");
          tabRegister.classList.add("active");
          tabRegister.setAttribute("aria-selected", "true");
          tabLogin.classList.remove("active");
          tabLogin.setAttribute("aria-selected", "false");
          registerPanel.style.display = "block";
          registerPanel.setAttribute("aria-hidden", "false");
          loginPanel.style.display = "none";
          loginPanel.setAttribute("aria-hidden", "true");
          console.log("‚úÖ Register tab activated");
        }

        // Event listeners for tabs
        tabLogin.addEventListener("click", function() {
          console.log("üñ±Ô∏è Login tab clicked");
          showLoginTab();
        });
        
        tabRegister.addEventListener("click", function() {
          console.log("üñ±Ô∏è Register tab clicked");
          showRegisterTab();
        });

        // Role-based field toggle
        roleRegister.addEventListener("change", function() {
          const role = this.value;
          console.log("üéØ Role selected:", role);
          
          // Hide all fields first
          workerFields.style.display = "none";
          healthCenterFields.style.display = "none";
          
          // Show appropriate fields
          if (role === "Worker") {
            workerFields.style.display = "block";
            console.log("‚úÖ Showing worker fields");
          } else if (role === "Health Center") {
            healthCenterFields.style.display = "block";
            console.log("‚úÖ Showing health center fields");
          }
        });

        // Login button handler
        const loginBtn = document.getElementById("loginBtn");
        const roleLogin = document.getElementById("roleLogin");
        const userId = document.getElementById("userId");
        const pwd = document.getElementById("pwd");
        
        if (loginBtn) {
          loginBtn.addEventListener("click", async function(e) {
            e.preventDefault();
            console.log("üîê Login button clicked");
            
            // Clear previous errors
            [roleLogin, userId, pwd].forEach(input => {
              const errorMsg = input.parentNode.querySelector('.error-message');
              if (errorMsg) errorMsg.remove();
              input.style.borderColor = '';
              input.style.boxShadow = '';
            });
            
            let isValid = true;
            
            // Validate role
            if (roleLogin.value === "Choose your role") {
              showError(roleLogin, "Please select your role");
              isValid = false;
            }
            
            // Validate user ID/email
            if (!userId.value.trim()) {
              showError(userId, "Please enter your email or worker ID");
              isValid = false;
            } else {
              const userIdValue = userId.value.trim();
              if (!validateEmail(userIdValue) && userIdValue.length < 6) {
                showError(userId, "Please enter a valid email or worker ID");
                isValid = false;
              }
            }
            
            // Validate password
            if (!pwd.value) {
              showError(pwd, "Please enter your password");
              isValid = false;
            } else if (pwd.value.length < 6) {
              showError(pwd, "Password must be at least 6 characters long");
              isValid = false;
            }
            
            if (!isValid) {
              console.log("‚ùå Login validation failed");
              return;
            }
            
            // Show loading state
            loginBtn.textContent = "Signing In...";
            loginBtn.disabled = true;
            
            try {
              console.log("üöÄ Mock authentication (no backend)...");
              
              // Simulate API delay
              await new Promise(resolve => setTimeout(resolve, 1000));
              
              // Mock authentication - accept any valid email/password combination
              const mockUserData = {
                token: "mock-jwt-token-" + Date.now(),
                user: {
                  id: "user-" + Date.now(),
                  role: roleLogin.value === "Health Center" ? "healthcare_center" : roleLogin.value.toLowerCase(),
                  profile: {
                    firstName: userId.value.split('@')[0] || "User",
                    email: userId.value,
                    phone: "+91 9876543210"
                  }
                }
              };
              
              console.log("üìä Mock login response:", mockUserData);
              
              // Store mock user data
              localStorage.setItem('token', mockUserData.token);
              localStorage.setItem('user', JSON.stringify(mockUserData.user));
              
              console.log("‚úÖ Mock login successful");
              alert(`Welcome ${mockUserData.user.profile.firstName}! Login successful.\n\nNote: This is a demo - no real authentication performed.`);
              
              // Redirect based on role
              const role = roleLogin.value;
              console.log("üîÑ Redirecting based on role:", role);
              
              if (role === "Health Center") {
                console.log("üè• Redirecting to healthcare center dashboard...");
                window.location.href = "../healthcare_center/healthcentre.html";
              } else if (role === "Worker") {
                console.log("üë∑ Redirecting to worker dashboard...");
                window.location.href = "../worker/worker-dashboard.html";
              } else if (role === "Admin") {
                console.log("üë®‚Äçüíº Redirecting to admin dashboard...");
                window.location.href = "../admin/admin-dashboard-new.html";
              } else {
                console.log("‚ö†Ô∏è Unknown role, using default redirect...");
                window.location.href = "../healthcare_center/healthcentre.html";
              }
            } catch (error) {
              console.error("‚ùå Mock login error:", error);
              showError(loginBtn, "Demo error occurred. Please try again.");
            } finally {
              // Reset button state
              loginBtn.textContent = "Access Health Records";
              loginBtn.disabled = false;
            }
          });
          console.log("‚úÖ Login button handler attached");
        }
        
        // Helper functions
        function validateEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        }
        
        function showError(element, message) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'error-message';
          errorDiv.style.cssText = `
            color: #dc2626;
            font-size: 12px;
            margin-top: 4px;
            font-weight: 500;
          `;
          errorDiv.textContent = message;
          element.parentNode.appendChild(errorDiv);
          
          element.style.borderColor = '#dc2626';
          element.style.boxShadow = '0 0 0 2px rgba(220, 38, 38, 0.1)';
        }

        // Registration form submission
        registerPanel.addEventListener("submit", async function(e) {
          e.preventDefault();
          console.log("üìù Registration form submitted");
          
          const role = roleRegister.value;
          const firstName = document.getElementById("firstName").value;
          const lastName = document.getElementById("lastName").value;
          const email = document.getElementById("email").value;
          const phone = document.getElementById("phone").value;
          const password = document.getElementById("password").value;
          
          // Get additional fields based on role
          let additionalData = {};
          if (role === "Worker") {
            additionalData = {
              // Personal Information
              dob: document.getElementById("dob").value,
              gender: document.getElementById("gender").value,
              bloodGroup: document.getElementById("bloodGroup").value,
              maritalStatus: document.getElementById("maritalStatus").value,
              
              // Contact Information
              address: document.getElementById("address").value,
              homeState: document.getElementById("homeState").value,
              emergencyContact: document.getElementById("emergencyContact").value,
              
              // Work Information
              occupation: document.getElementById("occupation").value,
              workLocation: document.getElementById("workLocation").value,
              startDate: document.getElementById("startDate").value,
              contractor: document.getElementById("contractor").value,
              workHours: document.getElementById("workHours").value,
              safetyTraining: document.getElementById("safetyTraining").value,
              
              // Health Information
              allergies: document.getElementById("allergies").value,
              chronicConditions: document.getElementById("chronicConditions").value,
              vaccinationStatus: document.getElementById("vaccinationStatus").value
            };
          } else if (role === "Health Center") {
            additionalData = {
              centerName: document.getElementById("centerName").value,
              centerAddress: document.getElementById("centerAddress").value,
              centerPincode: document.getElementById("centerPincode").value,
              centerType: document.getElementById("centerType").value,
              licenseNumber: document.getElementById("licenseNumber").value,
              services: document.getElementById("services").value
            };
          }
          
          console.log("üìä Registration data:", {
            role: role,
            firstName: firstName,
            lastName: lastName,
            email: email,
            phone: phone,
            additionalData: additionalData
          });
          
          // Mock registration (no backend)
          try {
            console.log("üöÄ Mock registration (no backend)...");
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Mock registration - accept any valid form data
            const mockUserData = {
              token: "mock-jwt-token-" + Date.now(),
              user: {
                id: "user-" + Date.now(),
                role: role === "Health Center" ? "healthcare_center" : role.toLowerCase(),
                profile: {
                  firstName: firstName || "User",
                  lastName: lastName || "",
                  email: email,
                  phone: phone,
                  ...additionalData
                }
              }
            };
            
            console.log("üìä Mock registration response:", mockUserData);
            
            // Store mock user data
            localStorage.setItem('token', mockUserData.token);
            localStorage.setItem('user', JSON.stringify(mockUserData.user));
            
            console.log("‚úÖ Mock registration successful!");
            alert(`‚úÖ Registration Successful!\n\nWelcome ${mockUserData.user.profile.firstName}!\nRole: ${role}\n\nNote: This is a demo - no real registration performed.\n\nRedirecting to dashboard...`);
            
            // Redirect based on role
            if (role === "Health Center") {
              console.log("üè• Redirecting to healthcare center dashboard...");
              window.location.href = "../healthcare_center/healthcentre.html";
            } else if (role === "Worker") {
              console.log("üë∑ Redirecting to worker dashboard...");
              window.location.href = "../worker/worker-dashboard.html";
            } else if (role === "Admin") {
              console.log("üë®‚Äçüíº Redirecting to admin dashboard...");
              window.location.href = "../admin/admin-dashboard-new.html";
            } else {
              console.log("‚ö†Ô∏è Unknown role, using default redirect...");
              window.location.href = "../healthcare_center/healthcentre.html";
            }
          } catch (error) {
            console.error('‚ùå Mock registration error:', error);
            alert(`‚ùå Demo Error!\n\nError: ${error.message}\n\nThis is a demo - please try again.`);
          }
        });

        // Add input event listeners to clear errors
        document.querySelectorAll("input, select").forEach((input) => {
          input.addEventListener("input", function () {
            const errorMsg = this.parentNode.querySelector('.error-message');
            if (errorMsg) errorMsg.remove();
            this.style.borderColor = '';
            this.style.boxShadow = '';
          });
          
          input.addEventListener("change", function () {
            const errorMsg = this.parentNode.querySelector('.error-message');
            if (errorMsg) errorMsg.remove();
            this.style.borderColor = '';
            this.style.boxShadow = '';
          });
        });

        // Test login functionality
        console.log("üß™ Testing login elements...");
        console.log("Login button found:", !!loginBtn);
        console.log("Role select found:", !!roleLogin);
        console.log("User ID input found:", !!userId);
        console.log("Password input found:", !!pwd);
        
        // Test redirect URLs
        console.log("üîó Testing redirect URLs...");
        console.log("Health Center URL:", "../healthcare_center/healthcentre.html");
        console.log("Worker URL:", "../worker/worker-dashboard.html");
        console.log("Admin URL:", "../admin/admin-dashboard-new.html");
        
        // Demo mode notification
        console.log("üé≠ DEMO MODE ACTIVE - No backend required!");
        console.log("üìù Login/Registration will work with mock authentication");
        console.log("üîÑ Users will be redirected to appropriate dashboards");
        console.log("üíæ User data will be stored in localStorage");

        console.log("‚úÖ All event listeners attached successfully");
      });
    </script>
  </body>
</html>

